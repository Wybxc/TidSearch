"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(i,t){function o(e){if("string"==typeof e&&null===(e=t.querySelector(e)))throw"Element not found!";if(e instanceof i.HTMLElement)return e;throw"Not an element!"}function a(e){return new Promise(function(t,n){var r=i.XMLHttpRequest?new i.XMLHttpRequest:new gloabl.ActiveXObject("Microsoft.XMLHTTP");r.open("GET",e,!0),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status||304==r.status){var e=JSON.parse(r.responseText);console.log(e),t(e)}else n("HTTP "+r.status+" error!")},r.send()})}function u(e,t){return e[t]}function s(e){return 0==(e=e.trim()).length?Promise.resolve([]):1==e.length?Promise.resolve([e]):a("//bird.ioliu.cn/v1?url=http://api.pullword.com/get.php&source=".concat(encodeURI(e),"&param1=0&param2=0&json=1")).then(function(e){return e.map(function(e){return e.t})})}function c(e,t){var n=0,r=(""+t.title).toUpperCase(),i=(""+t.category).toUpperCase(),o=(""+t.tags).toUpperCase(),a=(""+t.content).toUpperCase();return e.map(function(e){return e.toUpperCase()}).forEach(function(e){n+=r.includes(e)?3:0,n+=i.includes(e)?2:0,n+=o.includes(e)?2:0,n+=a.includes(e)?1:0}),n}var e=function(){function r(e){var t,n=this;_classCallCheck(this,r),this.input=e.input?o(e.input):null,this.output=o(e.output),this.json=null,this.template=e.template||'<p><a href="{url}">{title}</a></p>',this.templateMiddleware=e.templateMiddleware||u,this.noResult=e.noResult||"No Result.",this.segmenter=e.segmenter||s,this.match=e.match||c,this.paginator=e.paginator,this.afterSearch=e.afterSearch,this.loaded=(t=e.json,(Array.isArray(t)?Promise.resolve(t):"string"==typeof t?a(t):void 0).then(function(e){n.json=e},function(e){throw"Load JSON fail! "+e}).then(function(){if(!n.input.addEventListener){if(!n.input.attachEvent)throw"Your Browser is too old!";0}(function(e){n.input.addEventListener("input",e),n.input.addEventListener("paste",e)})(function(){return n.search(n.input.value)})}))}return _createClass(r,[{key:"search",value:function(e){var r=this;if(this.json)return this.segmenter(e).then(function(t){if(!t.length)return r.output.innerHTML="",[];var e=r.json.map(function(e){return{score:r.match(t,e),page:e}}).filter(function(e){return 0<e.score});if((e=e.sort(function(e,t){return t.score-e.score}).map(function(e){return e.page})).length){var n=e.map(function(e){return function(e,t,n){if(!e.replace)throw"Argument must be string!";return e.replace(/\{\w+?\}/g,function(e){return n(t,e.slice(1,-1))})}(r.template,e,r.templateMiddleware)});if(r.paginator)throw"Unimplemented";r.output.innerHTML=n.join("\n")}else r.output.innerHTML=r.noResult;return e}).then(function(e){return r.afterSearch&&r.afterSearch(e),e});var t="Please wait till JSON Loaded.";return console.warn(t),Promise.reject(t)}}]),r}();i.TidSearch=e}(window,document);